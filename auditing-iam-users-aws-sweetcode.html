<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Auditing IAM Users in AWS</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:400,500,600|Playfair+Display:400,700,900" rel="stylesheet">

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background: #fff;
      max-width: 900px;
      margin: 0 auto;
    }

    h1, h2, h3 {
      font-family: 'Playfair Display', serif;
    }

    h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    h2 {
      font-size: 24px;
      margin-top: 30px;
    }

    h3 {
      font-size: 20px;
      margin-top: 20px;
    }

    p {
      margin-bottom: 15px;
    }

    a {
      color: #007bff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    pre {
      background: #f4f4f4;
      padding: 12px;
      overflow-x: auto;
      border-left: 4px solid #555;
      margin: 20px 0;
    }

    code {
      font-family: monospace;
    }

    ul {
      margin-top: 10px;
      margin-bottom: 20px;
    }

    li {
      margin-bottom: 8px;
    }

    /* Article images */
    .logo-image {
      width: 180px;
      display: block;
      margin: 0 auto 20px auto;
    }

    .header-image {
      width: 100%;
      height: auto;
      margin: 20px 0 30px 0;
      border-radius: 4px;
    }

    /* Original publication */
    .original-publication {
      text-align: center;
      font-size: 0.9em;
      margin-bottom: 30px;
      color: #555;
    }

    .original-publication a {
      font-weight: 500;
    }

    /* Meta line under title */
    .post-meta {
      color: #666;
      margin-top: 0;
      margin-bottom: 20px;
    }

    .tag {
      display: inline-block;
      padding: 2px 10px;
      border: 1px solid #ddd;
      border-radius: 999px;
      font-size: 12px;
      margin-left: 8px;
      color: #555;
    }
  </style>
</head>

<body>

  <!-- Sweetcode Logo -->
  <img
    src="/images/Sweetcode-gray-shadow.png"
    alt="Sweetcode Logo"
    class="logo-image"
  >

  <!-- Header Image (add this file to /images) -->
  <img
    src="/images/auditing-iam-users-aws.png"
    alt="Auditing IAM Users in AWS"
    class="header-image"
  >

  <!-- Original Publication (replace with your archive link if you have it) -->
  <div class="original-publication">
    <p>
      Original publication:
      <a href="#"
         target="_blank"
         rel="noopener noreferrer">
        View on Sweetcode (Archived)
      </a>
    </p>
  </div>

  <h1>Auditing IAM Users in AWS</h1>
  <p><strong>by Wendy Segura</strong></p>
  <p class="post-meta">
    <em>3 years ago</em> | In Application Development
    <span class="tag">aws</span>
  </p>

  <p>
    Checking your AWS account to see how many IAM (Identity and Access Management) users you have is a great and very simple way to get started with auditing.
  </p>

  <p>
    You will be able to check if these users are following security best practices, such as having Multi-Factor Authentication (MFA) set up for their account, the last time they changed their password, and when they last rotated their access key.
  </p>

  <p>
    Let us suppose that everyone in the company had access to the AWS account. Even if their job description did not require any type of access, this would make the account vulnerable because anyone can go into the account, and it creates a less secure environment.
  </p>

  <p>
    Auditing IAM users and making sure that they need the access to perform their task is a start to not only practicing being more secure but also enforcing IAM best practices. After all, one of the basic principles of security in AWS is the <strong>Principle of Least Privilege</strong>, which means giving the minimum amount of access required to a user to perform their task.
  </p>

  <p>
    This is just one of the many IAM best practices that Amazon recommends. To read more on what IAM best practices to use and how to enforce them, you can click here:
    <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html" target="_blank" rel="noopener noreferrer">
      IAM Best Practices
    </a>.
  </p>

  <h2>Step 1: Get an Account Summary</h2>
  <p>
    For the first step, I recommend getting a summary report of your account. This is a great way to get a brief overview of the account.
  </p>

  <p>To do this, you can run this line of code using the AWS CLI:</p>
  <pre><code>aws iam get-account-summary</code></pre>

  <p>The output includes a <code>SummaryMap</code> similar to this:</p>
  <pre><code>{
  "SummaryMap": {
    "UsersQuota": 5000,
    "GroupsQuota": 100,
    "InstanceProfiles": 6,
    "SigningCertificatesPerUserQuota": 2,
    "AccountAccessKeysPresent": 0,
    "RolesQuota": 250,
    "RolePolicySizeQuota": 10240,
    "AccountSigningCertificatesPresent": 0,
    "Users": 27,
    "ServerCertificatesQuota": 20,
    "ServerCertificates": 0,
    "AssumeRolePolicySizeQuota": 2048,
    "Groups": 7,
    "MFADevicesInUse": 1,
    "Roles": 3,
    "AccountMFAEnabled": 1,
    "MFADevices": 3,
    "GroupsPerUserQuota": 10,
    "GroupPolicySizeQuota": 5120,
    "InstanceProfilesQuota": 100,
    "AccessKeysPerUserQuota": 2,
    "Providers": 0,
    "UserPolicySizeQuota": 2048
  }
}</code></pre>

  <h2>Step 2: Generate a Credential Report</h2>
  <p>
    The above is just an overview of what youâ€™ll see. Next, you should download a credentials report that gives you more detailed information, such as the username of each IAM user associated with the account.
  </p>

  <p>To generate the report:</p>
  <pre><code>aws iam generate-credential-report</code></pre>

  <p>Get the report and save the output into a txt or csv file:</p>
  <pre><code>aws iam get-credential-report --output text --query Content | base64 -D >> report.txt</code></pre>

  <h2>What the Credential Report Contains</h2>
  <p>This credential report contains fields like:</p>

  <pre><code>user
arn
user_creation_time
password_enabled
password_last_used
password_last_changed
password_next_rotation
mfa_active
access_key_1_active
access_key_1_last_rotated
access_key_1_last_used_date
access_key_1_last_used_region
access_key_1_last_used_service
access_key_2_active
access_key_2_last_rotated
access_key_2_last_used_date
access_key_2_last_used_region
access_key_2_last_used_service
cert_1_active
cert_1_last_rotated
cert_2_active
cert_2_last_rotated</code></pre>

  <h2>What to Do Next</h2>
  <p>
    You can now assess all your IAM users and whether these users are still active employees or need to be removed because they are no longer with your company.
  </p>

  <p>
    You should practice the auditing steps above at regular intervals as a best practice for security. You should also audit whenever there is a change in your organization, such as an employee leaving, or if you suspect an unauthorized person is trying to access your account.
  </p>

  <p>
    You can read more on AWS security auditing guidelines through this link:
    <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/security-audit-guide.html" target="_blank" rel="noopener noreferrer">
      Security Audit Guidelines
    </a>.
  </p>

  <h2>Automating Audits with AWS Lambda</h2>
  <p>
    Lastly, certain tracking can be automated through the use of an AWS Lambda function. You can run the function either monthly or biweekly to help you keep up-to-date on existing users and whether they have rotated their access keys or set up Multi-Factor Authentication.
  </p>

  <p><strong>Original Author: Wendy Segura</strong></p>

</body>
</html>
